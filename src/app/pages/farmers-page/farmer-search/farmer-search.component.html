<app-content-loader
  *appLet="state$ | async as state"
  [isLoading]="state.isLoading"
  [error]="state.error"
>
  <div *ngFor="let result of state.results" class="search-result">
    <h4>
      <ng-container *ngIf="result.farmer.display_name; else noName">{{ result.farmer.display_name }}</ng-container>
      <ng-template #noName>
        Unnamed farmer <a class="set-name-link" routerLink="/kb/set-friendly-leaderboard-name">Learn how to set a name &#10142;</a>
      </ng-template>
    </h4>
    <table class="details-view details-view-blue table-striped">
      <tr>
        <th>Launcher ID</th>
        <td>{{ result.farmer.launcher_id }}</td>
      </tr>
      <tr>
        <th>Points</th>
        <td>
          {{ result.farmer.points | number }}
          ({{ result.farmer.points_percentage / 100 | percent: '1.0-4' }})
        </td>
      </tr>
      <tr>
        <th>Difficulty</th>
        <td>{{ result.farmer.difficulty | number }}</td>
      </tr>
    </table>

    <h5>Last payouts</h5>

    <ng-container *ngIf="!result.payouts?.length; else payoutsTable">
      This farmer has no payouts.
    </ng-container>
    <ng-template #payoutsTable>
      <table>
        <thead>
        <tr>
          <th>Date</th>
          <th>Amount</th>
          <th>Transaction</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let payout of result.payouts">
          <td>{{ payout.payout.datetime | date: 'short' }}</td>
          <td>{{ payout.amount | xch }}</td>
          <td>{{ payout.transaction }}</td>
        </tr>
        </tbody>
      </table>
    </ng-template>

    <h5>Last partials</h5>

    <ng-container *ngIf="!result.partials?.length; else partialsTable">
      This farmer has no partials.
    </ng-container>
    <ng-template #partialsTable>
      <table>
        <thead>
        <tr>
          <th>Date</th>
          <th>Difficulty</th>
          <th>Error</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let partial of result.partials">
          <td>{{ partial.timestamp * 1000 | date: 'M/d/yy, h:mm:ss a' }}</td>
          <td>{{ partial.difficulty | number }}</td>
          <td>{{ partial.error || '-' }} </td>
        </tr>
        </tbody>
      </table>
    </ng-template>
  </div>
</app-content-loader>
