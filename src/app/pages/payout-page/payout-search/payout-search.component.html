<div class="page-content">
    <app-content-loader
        *appLet="state$ | async as state"
        [isLoading]="state.isLoading"
        [error]="state.error"
    >
        <section class="flex-start-center flex-gap-md mb-lg">
            <div class="page-title">Payout {{ state.payout?.id }}</div>
            <!-- TODO - make more human-readable: 1y 4m ago (2021-05-23) -->
            <p class="m-none">{{ state.payout?.datetime }}</p>
        </section>
        <h2>Coins</h2>
        <ng-container *ngIf="state.coinRecords as coins">
            <table class="stats-table mb-md">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Block Index</th>
                        <th>Farmed By</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let coin of coins">
                        <td>
                            {{ coin.timestamp * 1000 | date: 'short' }}
                        </td>
                        <td>{{ coin.confirmed_block_index }}</td>
                        <td>{{ coin.farmer_display_name }}</td>
                    </tr>
                </tbody>
            </table>
        </ng-container>
        <ng-container *ngIf="state.addresses">
            <h2>Farmer Payouts</h2>
            <table class="mb-md">
                <thead>
                    <tr>
                        <th>Farmer</th>
                        <th>Amount</th>
                        <th>Height</th>
                        <th>Transaction</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngIf="!state.addresses?.length; else payoutAddresses">
                        <td colspan="4">No records.</td>
                    </tr>
                    <ng-template #payoutAddresses>
                        <ng-container *ngFor="let address of state.addresses; let i = index;">
                            <tr>
                                <td>
                                    {{ address.farmer?.display_name || 'Unknown' }}
                                </td>
                                <td>{{ address.amount }}</td>
                                <td>{{ address.confirmed_height }}</td>
                                <td>{{ address.transaction }}</td>
                            </tr>
                        </ng-container>
                    </ng-template>
                </tbody>
            </table>
        </ng-container>
    </app-content-loader>
</div>
